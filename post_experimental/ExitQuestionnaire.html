{{ block title }}
Exit Questionnaire
{{ endblock }}

{{ block styles }}
<link href="https://unpkg.com/survey-jquery@1.12.18/defaultV2.min.css" rel="stylesheet">
<style>
    .exit-card {
        max-width: 900px;
        border: 1px solid #d6d9dd;
    }

    #surveyContainer .sd-btn.sd-navigation__next-btn,
    #surveyContainer .sd-btn.sd-navigation__complete-btn,
    #surveyContainer .sv-root-modern .sv-footer__next-btn,
    #surveyContainer .sv-root-modern .sv-footer__complete-btn {
        box-sizing: border-box;
        margin: 0;
        font-family: inherit;
        text-transform: none;
        -webkit-appearance: button;
        display: inline-block;
        font-weight: 400;
        line-height: 1.5;
        text-align: center;
        text-decoration: none;
        vertical-align: middle;
        user-select: none;
        border: 1px solid transparent;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        border-radius: 0.25rem;
        transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,
            border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        color: #fff;
        background-color: #0d6efd;
        border-color: #0d6efd;
        cursor: pointer;
    }

    #surveyContainer .sd-btn.sd-navigation__next-btn:hover,
    #surveyContainer .sd-btn.sd-navigation__complete-btn:hover,
    #surveyContainer .sv-root-modern .sv-footer__next-btn:hover,
    #surveyContainer .sv-root-modern .sv-footer__complete-btn:hover {
        color: #fff;
        background-color: #0b5ed7;
        border-color: #0a58ca;
    }

    #surveyContainer .sd-btn.sd-navigation__next-btn:focus,
    #surveyContainer .sd-btn.sd-navigation__complete-btn:focus,
    #surveyContainer .sv-root-modern .sv-footer__next-btn:focus,
    #surveyContainer .sv-root-modern .sv-footer__complete-btn:focus {
        color: #fff;
        background-color: #0b5ed7;
        border-color: #0a58ca;
        outline: 0;
        box-shadow: 0 0 0 0.25rem rgba(49, 132, 253, 0.5);
    }

    #surveyContainer .sd-btn.sd-navigation__next-btn:active,
    #surveyContainer .sd-btn.sd-navigation__complete-btn:active,
    #surveyContainer .sv-root-modern .sv-footer__next-btn:active,
    #surveyContainer .sv-root-modern .sv-footer__complete-btn:active {
        color: #fff;
        background-color: #0a58ca;
        border-color: #0a53be;
    }

    #surveyContainer .sd-btn.sd-navigation__next-btn:disabled,
    #surveyContainer .sd-btn.sd-navigation__complete-btn:disabled,
    #surveyContainer .sv-root-modern .sv-footer__next-btn:disabled,
    #surveyContainer .sv-root-modern .sv-footer__complete-btn:disabled {
        color: #fff;
        background-color: #0d6efd;
        border-color: #0d6efd;
        opacity: 0.65;
        cursor: default;
        pointer-events: none;
    }

    #surveyContainer .sv-root-modern,
    #surveyContainer .sd-root-modern {
        --sjs-general-backcolor: transparent;
        --sjs-general-backcolor-dim-light: transparent;
        --sjs-general-backcolor-dim-dark: transparent;
        background-color: transparent;
    }
</style>
{{ endblock }}

{{ block content }}
<div class="card exit-card shadow-sm mx-auto">
    <div class="card-body p-4">
        <div id="surveyContainer"></div>
    </div>
</div>

<input type="hidden" id="surveyResults" name="surveyResults" value="">
{{ endblock }}

{{ block scripts }}
<script src="https://unpkg.com/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://unpkg.com/survey-jquery@1.12.18/survey.jquery.min.js"></script>
<script id="exitSurveyJson" type="application/json">{{ include '_static/exit_questionnaire.json' }}</script>
<script>
    const exitSurveyJson = document.getElementById("exitSurveyJson").textContent;
    const survey = new Survey.Model(JSON.parse(exitSurveyJson));
    Survey.StylesManager.applyTheme("bootstrap");
    survey.showPrevButton = false;
    survey.showCompletedPage = false;

    survey.onTextMarkdown.add(function (_, options) {
        options.html = (options.text || "").replace(/\*(.*?)\*/g, "<em>$1</em>");
    });

    survey.onComplete.add(function (sender) {
        document.getElementById('surveyResults').value = JSON.stringify(sender.data);
        document.getElementById('form').submit();
    });

    $("#surveyContainer").Survey({model: survey});
</script>
{{ endblock }}
